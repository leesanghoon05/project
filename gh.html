<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•í™”ë„ ë§›ì§‘ íˆ¬í‘œ ì‚¬ì´íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .voting-section {
            margin-bottom: 40px;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .restaurant-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .restaurant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .restaurant-card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .restaurant-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.9em;
        }

        .restaurant-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .restaurant-type {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            background: #f0f0f0;
            padding: 4px 12px;
            border-radius: 15px;
            display: inline-block;
        }

        .restaurant-location {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .restaurant-description {
            font-size: 0.8em;
            color: #777;
            margin-bottom: 10px;
            font-style: italic;
            line-height: 1.3;
        }

        .restaurant-card.selected .restaurant-type {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .restaurant-card.selected .restaurant-location {
            color: rgba(255, 255, 255, 0.9);
        }

        .restaurant-card.selected .restaurant-description {
            color: rgba(255, 255, 255, 0.8);
        }

        .restaurant-specialties {
            font-size: 0.75em;
            color: #555;
            margin: 10px 0;
            text-align: left;
            line-height: 1.4;
        }

        .restaurant-features {
            font-size: 0.7em;
            color: #666;
            margin: 8px 0;
            text-align: left;
            line-height: 1.3;
        }

        .restaurant-card.selected .restaurant-specialties,
        .restaurant-card.selected .restaurant-features {
            color: rgba(255, 255, 255, 0.9);
        }

        .vote-count {
            background: #f0f0f0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #666;
            font-weight: bold;
        }

        .restaurant-card.selected .vote-count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .selected-indicator {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1em;
            margin: 15px;
            display: inline-block;
            font-weight: bold;
        }

        .vote-button {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .vote-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .vote-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-section {
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 15px;
        }

        .results-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .results-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .result-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .result-emoji {
            font-size: 1.5em;
            margin-right: 15px;
        }

        .result-info {
            flex-grow: 1;
        }

        .result-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .result-details {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 8px;
        }

        .result-bar {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .result-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.5s ease;
        }

        .result-count {
            margin-left: 15px;
            font-weight: bold;
            color: #666;
            font-size: 1.1em;
        }

        .winner-announcement {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 15px;
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            display: none;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* í”Œë¡œíŒ… ê´€ë¦¬ì íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .floating-admin {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .floating-admin-toggle {
            width: 50px;
            height: 50px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2em;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
            transition: all 0.3s ease;
        }

        .floating-admin-toggle:hover {
            background: #d32f2f;
            transform: scale(1.1);
        }

        .floating-admin-panel {
            position: absolute;
            bottom: 60px;
            right: 0;
            width: 320px;
            max-height: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .floating-admin-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .floating-admin-button {
            width: 100%;
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .floating-admin-button:hover {
            background: #d32f2f;
        }

        .floating-admin-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
        }

        .floating-admin-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 10px 8px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            color: #666;
        }

        .floating-admin-tab.active {
            background: #f44336;
            color: white;
        }

        .floating-admin-tab-content {
            display: none;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .floating-admin-tab-content.active {
            display: block;
        }

        #floatingAdminLogin {
            padding: 15px;
        }

        .floating-ip-record {
            background: #f8f9fa;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 3px solid #007bff;
            font-size: 11px;
        }

        .floating-ip-header {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
            font-size: 10px;
        }

        .floating-history-item {
            background: #f8f9fa;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            font-size: 11px;
            border-left: 3px solid #4CAF50;
        }

        @media (max-width: 768px) {
            .floating-admin-panel {
                width: 280px;
                right: -10px;
            }
            
            .floating-admin-toggle {
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }
        }

        @media (max-width: 768px) {
            .food-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ê°•í™”ë„ ë§›ì§‘ íˆ¬í‘œ ì‚¬ì´íŠ¸</h1>
        
        <div class="voting-section">
            <div style="text-align: center; margin-bottom: 20px;">
                <span class="selected-indicator" id="selectedIndicator" style="display: none;">
                    ì„ íƒëœ ë§›ì§‘: 0ê°œ
                </span>
            </div>
            
            <div class="food-grid" id="foodGrid">
                <!-- ë§›ì§‘ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <div style="text-align: center;">
                <button class="vote-button" id="voteButton" onclick="vote()" disabled>
                    ğŸ—³ï¸ íˆ¬í‘œí•˜ê¸°
                </button>
            </div>
        </div>

        <div class="winner-announcement" id="winnerAnnouncement">
            <!-- ë‹¹ì²¨ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <div class="results-section">
            <h2 class="results-title">ğŸ“Š íˆ¬í‘œ ê²°ê³¼</h2>
            <div class="results-chart" id="resultsChart">
                <!-- íˆ¬í‘œ ê²°ê³¼ ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ í•˜ë‹¨ ê´€ë¦¬ì ë¡œê·¸ì¸ -->
        <div class="floating-admin" id="floatingAdmin">
            <div class="floating-admin-toggle" onclick="toggleFloatingAdmin()">ğŸ”</div>
            <div class="floating-admin-panel" id="floatingAdminPanel" style="display: none;">
                <div id="floatingAdminLogin">
                    <form onsubmit="floatingAdminLogin(); return false;">
                        <input type="password" class="floating-admin-input" id="floatingAdminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="new-password">
                        <button type="submit" class="floating-admin-button">ë¡œê·¸ì¸</button>
                    </form>
                </div>
                
                <div class="floating-admin-content" id="floatingAdminContent" style="display: none;">
                    <div class="floating-admin-tabs">
                        <button class="floating-admin-tab active" onclick="showFloatingAdminTab('delete', this)">ì‚­ì œ</button>
                        <button class="floating-admin-tab" onclick="showFloatingAdminTab('ip', this)">IP</button>
                        <button class="floating-admin-tab" onclick="showFloatingAdminTab('history', this)">ê¸°ë¡</button>
                    </div>
                    
                    <div class="floating-admin-tab-content active" id="floatingDeleteTab">
                        <button class="floating-admin-button" onclick="adminReset()">ë°ì´í„° ì‚­ì œ</button>
                    </div>
                    
                    <div class="floating-admin-tab-content" id="floatingIpTab">
                        <div id="floatingIpRecords">
                            <!-- IP ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    
                    <div class="floating-admin-tab-content" id="floatingHistoryTab">
                        <div id="floatingVoteHistory">
                            <!-- íˆ¬í‘œ ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê°•í™”ë„ ë§›ì§‘ ë°ì´í„°
        const restaurants = [
            { 
                id: 1, 
                name: 'ê¸ˆë¬¸ë„', 
                type: 'ì¤‘ì‹ë‹¹', 
                location: 'ê°•í™”ì ê°•í™”í„°ë¯¸ë„ 2ì¸µ', 
                image: 'food/z1.png',
                description: 'ê°•í™”ë„ íŠ¹ì‚°ë¬¼ì„ í™œìš©í•œ ë…íŠ¹í•œ ì¤‘ì‹ ìš”ë¦¬ë¡œ ìœ ëª…í•œ ì˜ˆì•½ í•„ìˆ˜ ë§›ì§‘',
                specialties: ['ë°±ì§¬ë½• (ì‚¬ìë°œì•½ì‘¥ ë©´)', 'ì†ë…¸ë‘ ê°„ì§œì¥ (ê³ êµ¬ë§ˆíŠ€ê¹€)', 'ê°•í™” ìˆœë¬´ íƒ•ìˆ˜ìœ¡'],
                features: ['í…Œì´ë¸”ë§ ì˜ˆì•½ ì‹œìŠ¤í…œ', 'í‚¤ì˜¤ìŠ¤í¬ ì£¼ë¬¸', 'ê°•í™”ë„ íŠ¹ì„ ë©”ë‰´', 'ê¹”ë”í•œ ì¸í…Œë¦¬ì–´', 'ê°€ì„±ë¹„ ì¢‹ìŒ']
            },
            { 
                id: 2, 
                name: 'ì´ìœ ê°€', 
                type: 'í•œì‹ë‹¹', 
                location: 'ì„ ì›ë©´ ì‹œë¦¬ë¯¸ë¡œ í•˜ì²œê¸¸', 
                image: 'food/z2.png',
                description: 'ì²­êµ­ì¥ ë¹„ë¹”ë°¥ê³¼ ì‹œë˜ê¸°êµ­ë°¥ ì „ë¬¸ í˜„ì§€ì¸ ì¶”ì²œ ë§›ì§‘',
                specialties: ['ì²­êµ­ì¥ ë¹„ë¹”ë°¥ (8000ì›)', 'ì‹œë˜ê¸°êµ­ë°¥ (8000ì›)'],
                features: ['ì¼ìš”ì¼ ì •ê¸°íœ´ë¬´', 'ì˜¤ì „ 7ì‹œ~ì˜¤í›„ 2ì‹œ', 'ë°˜ì°¬ ë¦¬í•„ ê°€ëŠ¥', 'ì£¼ì°¨ ê°€ëŠ¥']
            },
            { 
                id: 3, 
                name: 'ì¡°ì–‘ë°©ì§', 
                type: 'ì¹´í˜', 
                location: 'ê°•í™”ì í–¥ë‚˜ë¬´ê¸¸5ë²ˆê¸¸ 12', 
                image: 'food/z3.png',
                description: 'ì˜› ë°©ì§ê³µì¥ì„ ì¹´í˜ë¡œ ê°œì¡°í•œ ê°•í™”ë„ ëŒ€í‘œ ê´€ê´‘ì§€ ì¹´í˜',
                specialties: ['ì•„ë©”ë¦¬ì¹´ë…¸ (7000ì›)', 'ë””ì €íŠ¸ë¥˜', 'ë”¸ê¸°ìˆ˜í”Œë ˆì¼€ì´í¬'],
                features: ['ë¬´ë£Œ ì£¼ì°¨', 'ì˜¤ì „ 11ì‹œ~ì˜¤í›„ 8ì‹œ', 'í¬í† ìŠ¤íŒŸ ë‹¤ìˆ˜', 'ë°•ë¬¼ê´€ ê³µê°„', 'ì•¼ì™¸ì„ ìš´ì˜']
            },
            { 
                id: 4, 
                name: 'ë§ˆë‹ˆì‚°ì‚°ì±„', 
                type: 'í•œì •ì‹', 
                location: 'í™”ë„ë©´ í•´ì•ˆë‚¨ë¡œ 1182', 
                image: 'food/z4.png',
                description: '144ë…„ ì „í†µ ê³ ì˜¥ì—ì„œ ì¦ê¸°ëŠ” 10ê°€ì§€ ì•½ì´ˆë°˜ì°¬ê³¼ 3ë…„ ìˆ™ì„± ëœì¥ì˜ ê±´ê°•í•œ í•œì •ì‹',
                specialties: ['ì‚°ì±„ë¹„ë¹”ë°¥ (ì‘¥ë°¥)', 'ì‚°ì±„ì†¥ë°¥ (ì¼ì¼ 100ê·¸ë¦‡ í•œì •)', 'ë–¡ê°ˆë¹„', '3ë…„ ìˆ™ì„± ëœì¥ì°Œê°œ'],
                features: ['1879ë…„ ê³ ì˜¥ ê±´ë¬¼', 'ê°ì¢… ë°©ì†¡ ì¶œì—°', 'ì›¨ì´íŒ… í•„ìˆ˜', 'ê°•í™”ë„ íŠ¹ì‚°ë¬¼ ì‚¬ìš©', 'ê±´ê°•ì‹']
            },
            { 
                id: 5, 
                name: 'ì¹¼êµ­ìˆ˜ ë§›ìˆëŠ”ì§‘', 
                type: 'í•œì‹ë‹¹', 
                location: 'í™”ë„ë©´ ë§ˆë‹ˆì‚°ë¡œ 569-1', 
                image: 'food/z5.png',
                description: 'ìˆ˜ì œ ë§Œë‘ì™€ ì¹¼ì¹¼í•œ ìœ¡ê°œì¥ ì „ê³¨ë¡œ ìœ ëª…í•œ ê°•í™”ë„ ëŒ€í‘œ ì¹¼êµ­ìˆ˜ ë§›ì§‘',
                specialties: ['ìœ¡ê°œì¥ ë§Œë‘ì „ê³¨ (30,000ì›)', 'ìˆ˜ì œ ë§Œë‘', 'ì¹¼êµ­ìˆ˜'],
                features: ['ë§¤ì¥ ì• ë„‰ë„‰í•œ ì£¼ì°¨ê³µê°„', 'ë§¤ì£¼ í™”ìš”ì¼ ì •ê¸°íœ´ë¬´', 'í‰ì¼ 09:00-19:30', 'ì£¼ë§ 08:30-20:00', 'í•´ì¥ ì¶”ì²œ']
            },
            { 
                id: 6, 
                name: 'ê°•í™”êµ­ìˆ˜', 
                type: 'êµ­ìˆ˜ì „ë¬¸ì ', 
                location: 'ê°•í™”ì ê´€ì²­ë¦¬ 488-1', 
                image: 'food/z6.png',
                description: '60ë…„ ì „í†µì˜ ê°•í™”ë„ ëŒ€í‘œ êµ­ìˆ˜ì§‘, ìˆ˜ìš”ë¯¸ì‹íšŒ ì¶œì—° ë§›ì§‘',
                specialties: ['ë¹„ë¹”êµ­ìˆ˜', 'ì”ì¹˜êµ­ìˆ˜', 'ì½©êµ­ìˆ˜ (ì—¬ë¦„ì²  ë³„ë¯¸)', 'ë¯¸ì†Œë§Œë‘ (2ì¸µ)'],
                features: ['1950ë…„ëŒ€ë¶€í„° ì˜ì—…', '2ëŒ€ì§¸ ìš´ì˜', 'ë§·ëŒë¡œ ì§ì ‘ ê°„ ì½©êµ­ë¬¼', 'ë§ì€í¸ ê³µí„° ì£¼ì°¨', 'ë¹ ë¥¸ íšŒì „ìœ¨']
            },
            { 
                id: 7, 
                name: 'ê·¸ ì™¸ì— - ë¬¼ê³ ê¸°', 
                type: 'íšŸì§‘', 
                location: 'ì°¾ì•„ë³´ë©´ ìˆìŒ', 
            },
            { 
                id: 8, 
                name: 'ê·¸ ì™¸ì— - ë°”ë² í', 
                type: 'ê³ ê¸°ì§‘', 
                location: 'ì°¾ì•„ë³´ë©´ ìˆìŒ', 
            }
        ];

        let selectedRestaurants = []; // ë‹¤ì¤‘ ì„ íƒìš© ë°°ì—´
        let votes = {};
        let voteHistory = [];
        let userIP = ''; // ì‚¬ìš©ì IP
        let isAdminLoggedIn = false;
        
        // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
        const ADMIN_PASSWORD = "D1"; 

        // JSONBin.io ì„¤ì •
        const JSONBIN_API_KEY = '$2a$10$w.PCpkS9Xsjul4.s4Xiafuaz2rrAipQ1O15xfhk44MCW82ApSPUTG'; // ì‹¤ì œ API í‚¤
        const JSONBIN_BIN_ID = ''; // ìƒì„±ë  BIN IDê°€ ì—¬ê¸°ì— ì €ì¥ë©ë‹ˆë‹¤
        const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';

        // ì›¹ ì €ì¥ì†Œì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadDataFromWeb() {
            try {
                // ì²˜ìŒ ì‚¬ìš©ì‹œ ë˜ëŠ” BIN IDê°€ ì—†ì„ ë•Œ ê¸°ë³¸ê°’ ì„¤ì •
                if (!JSONBIN_BIN_ID) {
                    console.log('ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”...');
                    restaurants.forEach(restaurant => {
                        votes[restaurant.id] = 0;
                    });
                    await saveDataToWeb(); // ì´ˆê¸° ë°ì´í„° ìƒì„±
                    return;
                }

                const response = await fetch(`${JSONBIN_BASE_URL}/${JSONBIN_BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Meta': 'false'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    votes = data.votes || {};
                    voteHistory = data.voteHistory || [];
                    
                    // ìƒˆ ë§›ì§‘ì´ ì¶”ê°€ëœ ê²½ìš° ì´ˆê¸°í™”
                    restaurants.forEach(restaurant => {
                        if (!votes[restaurant.id]) {
                            votes[restaurant.id] = 0;
                        }
                    });
                    
                    console.log('âœ… ì›¹ì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                } else {
                    throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.log('âš ï¸ ì›¹ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©:', error);
                loadDataFromLocal(); // ë°±ì—…ìœ¼ë¡œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©
            }
        }

        // ì›¹ ì €ì¥ì†Œì— ë°ì´í„° ì €ì¥
        async function saveDataToWeb() {
            try {
                const dataToSave = {
                    votes: votes,
                    voteHistory: voteHistory,
                    lastUpdated: new Date().toISOString(),
                    version: '1.0'
                };

                let url = JSONBIN_BASE_URL;
                let method = 'POST';
                
                // BIN IDê°€ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
                if (JSONBIN_BIN_ID) {
                    url += `/${JSONBIN_BIN_ID}`;
                    method = 'PUT';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY,
                        'X-Bin-Name': 'Ganghwa-Restaurant-Voting-Data',
                        'X-Bin-Private': 'false'
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (response.ok) {
                    const result = await response.json();
                    if (method === 'POST') {
                        // ìƒˆë¡œ ìƒì„±ëœ ê²½ìš° BIN ID ì €ì¥ (ì‹¤ì œë¡œëŠ” ì½”ë“œì— í•˜ë“œì½”ë”© í•„ìš”)
                        console.log('ğŸ†• ìƒˆ BIN ìƒì„±ë¨. BIN ID:', result.metadata.id);
                        console.log('âš ï¸ ì´ BIN IDë¥¼ ì½”ë“œì˜ JSONBIN_BIN_ID ë³€ìˆ˜ì— ë³µì‚¬í•˜ì„¸ìš”!');
                    }
                    console.log('âœ… ì›¹ì— ë°ì´í„° ì €ì¥ ì™„ë£Œ');
                    
                    // ë°±ì—…ìœ¼ë¡œ ë¡œì»¬ì—ë„ ì €ì¥
                    saveDataToLocal();
                } else {
                    throw new Error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('âŒ ì›¹ ì €ì¥ ì‹¤íŒ¨:', error);
                // ë°±ì—…ìœ¼ë¡œ ë¡œì»¬ì—ë§Œ ì €ì¥
                saveDataToLocal();
                alert('âš ï¸ ì˜¨ë¼ì¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.');
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ (ë°±ì—…ìš©)
        function loadDataFromLocal() {
            const savedVotes = localStorage.getItem('ganghwaRestaurants_permanent');
            const savedHistory = localStorage.getItem('ganghwaHistory_permanent');
            
            if (savedVotes) {
                votes = JSON.parse(savedVotes);
            } else {
                restaurants.forEach(restaurant => {
                    votes[restaurant.id] = 0;
                });
            }
            
            if (savedHistory) {
                voteHistory = JSON.parse(savedHistory);
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥ (ë°±ì—…ìš©)
        function saveDataToLocal() {
            localStorage.setItem('ganghwaRestaurants_permanent', JSON.stringify(votes));
            localStorage.setItem('ganghwaHistory_permanent', JSON.stringify(voteHistory));
        }

        // ì‚¬ìš©ì IP ê°€ì ¸ì˜¤ê¸°
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
            } catch (error) {
                // IPë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ëŠ” ê²½ìš° ë¡œì»¬ ì‹ë³„ì ì‚¬ìš©
                userIP = 'Local-' + Math.random().toString(36).substr(2, 9);
            }
        }

        // ì„ íƒëœ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedIndicator() {
            const indicator = document.getElementById('selectedIndicator');
            if (selectedRestaurants.length > 0) {
                indicator.style.display = 'inline-block';
                indicator.textContent = `ì„ íƒëœ ë§›ì§‘: ${selectedRestaurants.length}ê°œ`;
            } else {
                indicator.style.display = 'none';
            }
        }

        // ë§›ì§‘ ì¹´ë“œ ìƒì„±
        function createRestaurantCards() {
            const foodGrid = document.getElementById('foodGrid');
            foodGrid.innerHTML = '';

            restaurants.forEach(restaurant => {
                const card = document.createElement('div');
                card.className = 'restaurant-card';
                card.onclick = () => selectRestaurant(restaurant.id);
                
                if (selectedRestaurants.includes(restaurant.id)) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    ${restaurant.image ? 
                        `<img src="${restaurant.image}" alt="${restaurant.name}" class="restaurant-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                         <div class="restaurant-image" style="display: none;">ì‚¬ì§„ ì¤€ë¹„ì¤‘</div>` :
                        `<div class="restaurant-image">ì‚¬ì§„ ì¤€ë¹„ì¤‘</div>`
                    }
                    <div class="restaurant-name">${restaurant.name}</div>
                    <div class="restaurant-type">${restaurant.type}</div>
                    <div class="restaurant-location">ğŸ“ ${restaurant.location}</div>
                    ${restaurant.description ? `<div class="restaurant-description">${restaurant.description}</div>` : ''}
                    ${restaurant.specialties ? `
                        <div class="restaurant-specialties" style="font-size: 0.75em; color: #555; margin: 10px 0; text-align: left;">
                            <strong>ëŒ€í‘œë©”ë‰´:</strong><br>
                            ${restaurant.specialties.slice(0, 3).map(item => `â€¢ ${item}`).join('<br>')}
                            ${restaurant.specialties.length > 3 ? `<br>â€¢ ì™¸ ${restaurant.specialties.length - 3}ê°œ ë©”ë‰´` : ''}
                        </div>
                    ` : ''}
                    ${restaurant.features ? `
                        <div class="restaurant-features" style="font-size: 0.7em; color: #666; margin: 8px 0; text-align: left;">
                            ${restaurant.features.slice(0, 3).map(item => `â€¢ ${item}`).join('<br>')}
                            ${restaurant.features.length > 3 ? `<br>â€¢ ì™¸ ${restaurant.features.length - 3}ê°œ` : ''}
                        </div>
                    ` : ''}
                    <div class="vote-count">${votes[restaurant.id] || 0}í‘œ</div>
                `;
                
                card.id = `restaurant-${restaurant.id}`;
                foodGrid.appendChild(card);
            });
        }

        // ë§›ì§‘ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)
        function selectRestaurant(restaurantId) {
            const index = selectedRestaurants.indexOf(restaurantId);
            const card = document.getElementById(`restaurant-${restaurantId}`);
            
            if (index > -1) {
                // ì´ë¯¸ ì„ íƒëœ ê²½ìš° ì œê±°
                selectedRestaurants.splice(index, 1);
                card.classList.remove('selected');
            } else {
                // ìƒˆë¡œ ì„ íƒ
                selectedRestaurants.push(restaurantId);
                card.classList.add('selected');
            }
            
            updateSelectedIndicator();
            updateVoteButton();
        }

        // íˆ¬í‘œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateVoteButton() {
            const voteButton = document.getElementById('voteButton');
            if (selectedRestaurants.length > 0) {
                voteButton.disabled = false;
                voteButton.textContent = `ğŸ—³ï¸ ${selectedRestaurants.length}ê°œ íˆ¬í‘œí•˜ê¸°`;
            } else {
                voteButton.disabled = true;
                voteButton.textContent = 'ğŸ—³ï¸ íˆ¬í‘œí•˜ê¸°';
            }
        }

        // íˆ¬í‘œí•˜ê¸°
        async function vote() {
            if (selectedRestaurants.length === 0) return;

            try {
                // IPê°€ ì—†ìœ¼ë©´ ë¨¼ì € ê°€ì ¸ì˜¤ê¸°
                if (!userIP) {
                    await getUserIP();
                }

                let voteMessage = '';
                const now = new Date();
                
                selectedRestaurants.forEach(restaurantId => {
                    const restaurant = restaurants.find(r => r.id === restaurantId);
                    votes[restaurantId] = (votes[restaurantId] || 0) + 1;

                    // íˆ¬í‘œ ê¸°ë¡ ì¶”ê°€ (IP í¬í•¨)
                    voteHistory.unshift({
                        restaurant: restaurant.name,
                        type: restaurant.type,
                        location: restaurant.location,
                        ip: userIP,
                        timestamp: now.toLocaleString('ko-KR')
                    });
                    
                    voteMessage += `${restaurant.name} `;
                });

                // ìµœëŒ€ 500ê°œ ê¸°ë¡ë§Œ ìœ ì§€
                if (voteHistory.length > 500) {
                    voteHistory = voteHistory.slice(0, 500);
                }

                // ì›¹ ì €ì¥ì†Œì— ì €ì¥ (ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ì €ì¥ì†Œ ë°±ì—…)
                await saveDataToWeb();
                updateDisplay();
                
                // ì„ íƒ ì´ˆê¸°í™”
                selectedRestaurants = [];
                document.querySelectorAll('.restaurant-card').forEach(card => {
                    card.classList.remove('selected');
                });
                updateVoteButton();
                updateSelectedIndicator();

                alert(`${voteMessage}ì— íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤!`);

            } catch (error) {
                console.error('íˆ¬í‘œ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                alert('íˆ¬í‘œëŠ” ì™„ë£Œë˜ì—ˆì§€ë§Œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê²°ê³¼ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateResultsChart() {
            const resultsChart = document.getElementById('resultsChart');
            resultsChart.innerHTML = '';

            const maxVotes = Math.max(...Object.values(votes));
            if (maxVotes === 0) {
                resultsChart.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ì•„ì§ íˆ¬í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const sortedRestaurants = restaurants.sort((a, b) => (votes[b.id] || 0) - (votes[a.id] || 0));

            sortedRestaurants.forEach(restaurant => {
                const voteCount = votes[restaurant.id] || 0;
                const percentage = maxVotes > 0 ? (voteCount / maxVotes) * 100 : 0;

                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <span class="result-emoji">ğŸ½ï¸</span>
                    <div class="result-info">
                        <div class="result-name">${restaurant.name}</div>
                        <div class="result-details">${restaurant.type} Â· ${restaurant.location}</div>
                        <div class="result-bar">
                            <div class="result-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                    <span class="result-count">${voteCount}í‘œ</span>
                `;
                resultsChart.appendChild(resultItem);
            });
        }

        // í”Œë¡œíŒ… ê´€ë¦¬ì íŒ¨ë„ í† ê¸€
        function toggleFloatingAdmin() {
            const panel = document.getElementById('floatingAdminPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        // í”Œë¡œíŒ… ê´€ë¦¬ì ë¡œê·¸ì¸
        function floatingAdminLogin() {
            const password = document.getElementById('floatingAdminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                document.getElementById('floatingAdminLogin').style.display = 'none';
                document.getElementById('floatingAdminContent').style.display = 'block';
                
                updateFloatingIPRecords();
                updateFloatingVoteHistory();
                alert('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ!');
            } else {
                alert('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
                document.getElementById('floatingAdminPassword').value = '';
            }
        }

        // í”Œë¡œíŒ… ê´€ë¦¬ì íƒ­ ì „í™˜
        function showFloatingAdminTab(tabName, element) {
            if (!isAdminLoggedIn) return;

            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.floating-admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.floating-admin-tab-content').forEach(content => content.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            element.classList.add('active');
            document.getElementById('floating' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.add('active');

            if (tabName === 'ip') {
                updateFloatingIPRecords();
            } else if (tabName === 'history') {
                updateFloatingVoteHistory();
            }
        }

        // í”Œë¡œíŒ… IP ê¸°ë¡ ì—…ë°ì´íŠ¸
        function updateFloatingIPRecords() {
            const ipRecords = document.getElementById('floatingIpRecords');
            ipRecords.innerHTML = '';

            if (voteHistory.length === 0) {
                ipRecords.innerHTML = '<div style="text-align: center; color: #666; padding: 15px; font-size: 11px;">IP ê¸°ë¡ ì—†ìŒ</div>';
                return;
            }

            // IPë³„ ê·¸ë£¹í™”
            const ipGroups = {};
            voteHistory.forEach(record => {
                if (!ipGroups[record.ip]) {
                    ipGroups[record.ip] = [];
                }
                ipGroups[record.ip].push(record);
            });

            // íˆ¬í‘œ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
            const sortedIPs = Object.keys(ipGroups).sort((a, b) => ipGroups[b].length - ipGroups[a].length);

            sortedIPs.slice(0, 10).forEach(ip => {
                const ipGroup = ipGroups[ip];
                const ipRecord = document.createElement('div');
                ipRecord.className = 'floating-ip-record';
                
                ipRecord.innerHTML = `
                    <div class="floating-ip-header">IP: ${ip} (${ipGroup.length}íšŒ)</div>
                    <div>${ipGroup.slice(0, 3).map(record => 
                        `${record.restaurant}`
                    ).join(', ')}${ipGroup.length > 3 ? ` +${ipGroup.length - 3}ê°œ` : ''}</div>
                `;
                
                ipRecords.appendChild(ipRecord);
            });
        }

        // í”Œë¡œíŒ… íˆ¬í‘œ ê¸°ë¡ ì—…ë°ì´íŠ¸
        function updateFloatingVoteHistory() {
            const historyDiv = document.getElementById('floatingVoteHistory');
            historyDiv.innerHTML = '';

            if (voteHistory.length === 0) {
                historyDiv.innerHTML = '<div style="text-align: center; color: #666; padding: 15px; font-size: 11px;">íˆ¬í‘œ ê¸°ë¡ ì—†ìŒ</div>';
                return;
            }

            voteHistory.slice(0, 15).forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = 'floating-history-item';
                historyItem.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 3px;">${record.restaurant}</div>
                    <div style="font-size: 10px; color: #666;">${record.timestamp}</div>
                `;
                historyDiv.appendChild(historyItem);
            });
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            createRestaurantCards();
            updateResultsChart();
            updateSelectedIndicator();
        }

        // ê´€ë¦¬ì ì „ìš© ì™„ì „ ë¦¬ì…‹
        async function adminReset() {
            if (!isAdminLoggedIn) {
                alert('âŒ ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!');
                return;
            }
            
            if (confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  íˆ¬í‘œ ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                if (confirm('ğŸ”´ ë§ˆì§€ë§‰ í™•ì¸: ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        votes = {};
                        voteHistory = [];
                        selectedRestaurants = [];
                        
                        restaurants.forEach(restaurant => {
                            votes[restaurant.id] = 0;
                        });
                        
                        // ì›¹ ì €ì¥ì†Œì—ì„œ ì‚­ì œ (ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ì €ì¥ì†Œë§Œ ì‚­ì œ)
                        await saveDataToWeb();
                        
                        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œë„ ì‚­ì œ
                        localStorage.removeItem('ganghwaRestaurants_permanent');
                        localStorage.removeItem('ganghwaHistory_permanent');
                        
                        updateDisplay();
                        alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        
                    } catch (error) {
                        console.error('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
                        alert('âš ï¸ ì›¹ ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ ë¡œì»¬ ë°ì´í„°ëŠ” ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = async function() {
            await getUserIP();
            await loadDataFromWeb();
            updateDisplay();
        };
    </script>
</body>
</html>
